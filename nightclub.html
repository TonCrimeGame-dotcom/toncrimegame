<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TonCrime - Nightclub</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="game-core.js"></script>

<style>
body{
  margin:0;
  background:#120018;
  color:white;
  font-family:Arial;
}

.topbar{
  background:#1e0028;
  padding:18px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.right-stats{ width:420px; }

.bar{
  width:100%;
  height:8px;
  background:#333;
  border-radius:5px;
  overflow:hidden;
  margin-bottom:6px;
}

.fill{ height:100%; }
.xp{ background:#ff00ff; }
.energy{ background:#ffcc00; }

.main{
  padding:60px;
  display:flex;
  justify-content:center;
}

.card{
  width:400px;
  background:#1e0028;
  padding:30px;
  border-radius:12px;
  text-align:center;
  border:1px solid #3a004d;
}

button{
  width:100%;
  padding:14px;
  margin-top:15px;
  background:#ff00ff;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}

button:hover{ opacity:0.85; }
</style>
</head>
<body>

<div class="topbar">
  <div><b>Nightclub</b></div>

  <div class="right-stats">
    <div id="stats"></div>

    <div class="bar">
      <div id="xpBar" class="fill xp"></div>
    </div>

    <div class="bar">
      <div id="energyBar" class="fill energy"></div>
    </div>
  </div>
</div>

<div class="main">
  <div class="card">
    <h2>ðŸŽµ VIP Parti</h2>
    Enerji: 15<br>
    KazanÃ§: 20 - 120 Yton<br>
    XP: 10 - 25<br>
    <button onclick="party()">Partiye KatÄ±l</button>
  </div>
</div>

<script>

async function party(){

  let user=await loadUser();
  if(!user) return;

  user=await regenEnergy(user);

  const energyCost=15;

  if(user.energy<energyCost){
    alert("Yetersiz enerji!");
    return;
  }

  let success=Math.random()>0.2; // %80 baÅŸarÄ±

  if(success){

    let rewardYton=Math.floor(Math.random()*101)+20;
    let rewardXp=Math.floor(Math.random()*16)+10;

    await updateUser({
      energy:-energyCost,
      xp:rewardXp,
      yton:rewardYton
    });

    alert("BaÅŸarÄ±lÄ±! +" + rewardXp + " XP +" + rewardYton + " Yton");

  }else{

    await updateUser({
      energy:-energyCost
    });

    alert("Parti kÃ¶tÃ¼ geÃ§ti... Enerji kaybettin.");
  }

  render();
}

async function render(){

  let user=await loadUser();
  if(!user) return;

  user=await regenEnergy(user);

  renderStats(user);
}

render();
setInterval(render,3000);

</script>

</body>
</html>
