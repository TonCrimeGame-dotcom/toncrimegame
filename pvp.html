<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>‚öîÔ∏è PvP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#0b0b0b;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  margin:0;
  padding:20px;
}
.box{
  background:#151515;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
}
h2{text-align:center}
button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  background:#222;
  color:#fff;
  font-size:16px;
}
button:hover{background:#333}
img{
  width:100%;
  border-radius:10px;
  margin:10px 0;
}
.result{
  text-align:center;
  font-size:18px;
  padding:20px 0;
}
.back{
  background:#500;
}
</style>
</head>

<body>

<div class="box">
  <h2>‚öîÔ∏è PvP</h2>
  <div id="content">Y√ºkleniyor...</div>
</div>

<button class="back" onclick="location.href='index.html'">‚¨Ö Ana Men√º</button>

<!-- SUPABASE -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
// ===== AYARLAR =====
const SUPABASE_URL = "https://hwhscuyudwphnsipibpy.supabase.co";
const SUPABASE_KEY = "sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu";
const TELEGRAM_ID = "162154220";
// ===================

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
let startTime = 0;

// PvP Sorusu Y√ºkle
async function loadPvP(){
  const { data, error } = await sb
    .from("pvp_questions")
    .select("*")
    .eq("active", true)
    .limit(1)
    .single();

  if(error || !data){
    document.getElementById("content").innerHTML =
      "<div class='result'>‚ùå PvP sorusu bulunamadƒ±</div>";
    return;
  }

  startTime = Date.now();

  document.getElementById("content").innerHTML = `
    ${data.image_url ? `<img src="${data.image_url}">` : ``}
    <p><b>${data.question}</b></p>

    <button onclick="answerPvP(${data.id},'A')">A) ${data.option_a}</button>
    <button onclick="answerPvP(${data.id},'B')">B) ${data.option_b}</button>
    <button onclick="answerPvP(${data.id},'C')">C) ${data.option_c}</button>
    <button onclick="answerPvP(${data.id},'D')">D) ${data.option_d}</button>
  `;
}

// Cevap Ver
async function answerPvP(qid, ans){
  const timeSpent = Math.floor((Date.now() - startTime) / 1000);

  const { data, error } = await sb.rpc("pvp_answer",{
    p_telegram_id: TELEGRAM_ID,
    p_question_id: qid,
    p_answer: ans,
    p_time: timeSpent
  });

  if(error || !data){
    document.getElementById("content").innerHTML =
      "<div class='result'>‚ùå Sunucu hatasƒ±</div>";
    return;
  }

  if(data.result === "win"){
    document.getElementById("content").innerHTML = `
      <div class="result">
        üèÜ <b>Kazandƒ±n!</b><br><br>
        +${data.xp} XP<br>
        +${data.yton} YTon
      </div>
    `;
  }else{
    document.getElementById("content").innerHTML = `
      <div class="result">
        ‚ùå <b>Kaybettin</b><br><br>
        ${data.yton} YTon
      </div>
    `;
  }
}

// Ba≈ülat
loadPvP();
</script>

</body>
</html>
