<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TonCrime - Hastane</title>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{margin:0;background:#0e1117;color:white;font-family:Arial;}
.topbar{background:#111827;padding:18px 40px;border-bottom:1px solid #1f2937;display:flex;justify-content:space-between;align-items:center;}
.left-top{display:flex;align-items:center;gap:15px;}
.menu-btn{font-size:22px;cursor:pointer;color:#38bdf8;}
.logo{font-size:24px;font-weight:bold;color:#38bdf8;}
.right-stats{width:420px;}
.bar{width:100%;height:8px;background:#1f2937;border-radius:5px;overflow:hidden;margin-bottom:6px;}
.bar-fill{height:100%;transition:0.3s;}
.xp-fill{background:limegreen;}
.energy-fill{background:#facc15;}
.sidebar{position:fixed;top:0;left:-260px;width:250px;height:100%;background:#111827;padding:25px;transition:0.3s;z-index:2000;}
.sidebar.open{left:0;}
.overlay{position:fixed;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;z-index:1500;}
.overlay.show{display:block;}
.main{display:flex;justify-content:center;gap:40px;padding:40px;}
.center{width:50%;text-align:center;}
.userpanel{width:25%;background:#111827;padding:20px;border-radius:10px;height:fit-content;border:1px solid #1f2937;}
.card{background:#1f2937;padding:20px;border-radius:10px;}
button{width:100%;padding:12px;background:#38bdf8;border:none;font-weight:bold;cursor:pointer;border-radius:6px;margin-top:15px;color:black;}
button:hover{background:#0ea5e9;}
.result-box{position:fixed;bottom:30px;right:30px;background:#1f2937;padding:20px;border-radius:10px;border-left:5px solid #38bdf8;display:none;z-index:3000;min-width:250px;}
.result-box.success{border-color:limegreen;}
.result-box.fail{border-color:red;}
.timer{font-size:22px;margin-top:15px;color:#facc15;}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h3 style="color:#38bdf8">MenÃ¼</h3>
  <p onclick="location.href='index.html'">ğŸ  Ana Sayfa</p>
  <p onclick="location.href='missions.html'">ğŸ¯ GÃ¶revler</p>
  <p onclick="location.href='nightclub.html'">ğŸµ Gece KulÃ¼bÃ¼</p>
  <p onclick="location.href='coffeeshop.html'">â˜• Coffee Shop</p>
  <p onclick="location.href='weapons.html'">ğŸ”« Silah KaÃ§akÃ§Ä±sÄ±</p>
  <p onclick="location.href='hospital.html'">ğŸ¥ Hastane</p>
</div>
<div class="overlay" id="overlay"></div>

<div class="topbar">
  <div class="left-top">
    <div class="menu-btn" onclick="openMenu()">â˜°</div>
    <div class="logo">Hastane</div>
  </div>
  <div class="right-stats">
    <div id="stats"></div>
    <div class="bar"><div class="bar-fill xp-fill" id="xpBar"></div></div>
    <div class="bar"><div class="bar-fill energy-fill" id="energyBar"></div></div>
  </div>
</div>

<div class="main">
  <div class="center">
    <div class="card">
      <h2>ğŸ¥ Tedavi AlanÄ±</h2>
      <div id="hospitalStatus"></div>
      <div class="timer" id="timer"></div>
      <div id="actionArea"></div>
    </div>
  </div>
  <div class="userpanel" id="userinfo"></div>
</div>

<div class="result-box" id="resultBox"></div>

<script>
const SUPABASE_URL="https://hwhscuyudwphnsipibpy.supabase.co";
const SUPABASE_KEY="sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu";
const db=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

const userId=localStorage.getItem("tc_user");
const MAX_ENERGY=100;
const HEAL_COST=20; // Yton

function openMenu(){
  document.getElementById("sidebar").classList.add("open");
  document.getElementById("overlay").classList.add("show");
}
document.getElementById("overlay").onclick=()=>{
  document.getElementById("sidebar").classList.remove("open");
  document.getElementById("overlay").classList.remove("show");
};

function showResult(text,type){
  const box=document.getElementById("resultBox");
  box.className="result-box "+type;
  box.innerHTML=text;
  box.style.display="block";
  setTimeout(()=>box.style.display="none",3000);
}

async function loadUser(){
  const {data}=await db.from("users").select("*").eq("id",userId).maybeSingle();
  return data;
}

async function healFree(){
  await db.from("users").update({
    energy:100,
    hospital_until:null
  }).eq("id",userId);
  showResult("Ãœcretsiz iyileÅŸtin!","success");
  render();
}

async function healPaid(){
  let user=await loadUser();
  if(user.yton < HEAL_COST){
    showResult("Yetersiz Yton!","fail");
    return;
  }

  await db.from("users").update({
    energy:100,
    hospital_until:null,
    yton:user.yton - HEAL_COST
  }).eq("id",userId);

  showResult("AnÄ±nda iyileÅŸtin!","success");
  render();
}

async function render(){
  const user=await loadUser();
  if(!user) return;

  document.getElementById("stats").innerHTML=
  `Lv ${user.level} | XP ${user.xp}/100 | âš¡ ${user.energy} | ğŸ’° ${user.yton}`;

  document.getElementById("xpBar").style.width=(user.xp/100*100)+"%";
  document.getElementById("energyBar").style.width=(user.energy/100*100)+"%";

  document.getElementById("userinfo").innerHTML=
  `ID: ${user.id}<br>
   Takma Ad: ${user.nickname}<br>
   Seviye: ${user.level}<br>
   Yton: ${user.yton}`;

  const now=Date.now();
  const until=user.hospital_until;

  if(!until || now >= until){
    document.getElementById("hospitalStatus").innerHTML="Durum: SaÄŸlÄ±klÄ±sÄ±n";
    document.getElementById("timer").innerHTML="";
    document.getElementById("actionArea").innerHTML=
      `<button onclick="healFree()">Enerjiyi Full Yap</button>`;
  }else{
    document.getElementById("hospitalStatus").innerHTML="Durum: Hastanedesin";

    const diff=until-now;
    const h=Math.floor(diff/3600000);
    const m=Math.floor((diff%3600000)/60000);
    const s=Math.floor((diff%60000)/1000);

    document.getElementById("timer").innerHTML=
      h+"s "+m+"d "+s+"sn";

    document.getElementById("actionArea").innerHTML=
      `<button onclick="healPaid()">AnÄ±nda Ä°yileÅŸ (${HEAL_COST} Yton)</button>`;
  }
}

render();
setInterval(render,1000);
</script>

</body>
</html>
