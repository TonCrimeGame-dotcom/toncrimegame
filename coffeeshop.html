<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TonCrime - Coffee Shop</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="game-core.js"></script>

<style>
body{
  margin:0;
  background:#071a0f;
  color:white;
  font-family:Arial;
}

/* TOPBAR */
.topbar{
  background:#0c2e19;
  padding:18px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.right-stats{
  width:420px;
}

.bar{
  width:100%;
  height:8px;
  background:#222;
  border-radius:5px;
  overflow:hidden;
  margin-bottom:6px;
}

.fill{
  height:100%;
}

.xp{ background:#00ff88; }
.energy{ background:#00ffaa; }

/* SHOP GRID */
.main{
  padding:40px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
}

.card{
  background:#0f2b1c;
  padding:15px;
  border-radius:10px;
  border:1px solid #145c34;
}

button{
  width:100%;
  padding:10px;
  margin-top:8px;
  background:#00ff88;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}

button:hover{opacity:0.85;}
</style>
</head>
<body>

<div class="topbar">
  <div><b>Coffee Shop</b></div>

  <div class="right-stats">
    <div id="stats"></div>

    <div class="bar">
      <div id="xpBar" class="fill xp"></div>
    </div>

    <div class="bar">
      <div id="energyBar" class="fill energy"></div>
    </div>
  </div>
</div>

<div class="main" id="shop"></div>

<script>

/* ===== SHOP PRODUCTS ===== */
function generateProducts(){
  let arr=[];
  for(let i=1;i<=20;i++){
    let price=Math.floor(Math.random()*101)+100; //100-200
    let energy=Math.floor((price-100)/100*50)+30; //30-80
    arr.push({
      name:"Ürün "+i,
      price:price,
      energy:energy
    });
  }
  return arr;
}

/* ===== BUY ===== */
async function buy(product){

  let user=await loadUser();
  if(!user) return;

  if(user.yton<product.price){
    alert("Yetersiz Yton");
    return;
  }

  await updateUser({
    yton:-product.price,
    energy:product.energy
  });

  alert("Satın alındı! +" + product.energy + " enerji");

  render();
}

/* ===== RENDER PAGE ===== */
async function render(){

  let user=await loadUser();
  if(!user) return;

  user=await regenEnergy(user);

  renderStats(user);

  let products=generateProducts();
  let html="";

  products.forEach(p=>{
    html+=`
    <div class="card">
      <b>${p.name}</b><br>
      Fiyat: ${p.price} Yton<br>
      Enerji: +${p.energy}
      <button onclick='buy(${JSON.stringify(p)})'>
        Satın Al
      </button>
    </div>
    `;
  });

  document.getElementById("shop").innerHTML=html;
}

render();
setInterval(render,3000);

</script>

</body>
</html>
