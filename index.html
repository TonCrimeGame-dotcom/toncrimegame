<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TonCrime</title>

<!-- TELEGRAM MINI APP -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- SUPABASE -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>

/* ===== GLOBAL ===== */
body{
margin:0;
background:#0e0e0e;
color:white;
font-family:Arial;
overflow-x:hidden;
}

/* ===== TOPBAR ===== */
.topbar{
position:fixed;
top:0;
left:0;
width:100%;
background:#111;
padding:16px 25px;
display:flex;
justify-content:space-between;
align-items:center;
border-bottom:1px solid #222;
z-index:2000;
}

.logo{color:gold;font-weight:bold;font-size:22px;}
.menu-btn{cursor:pointer;font-size:22px;margin-right:15px;}

/* ===== SIDEBAR ===== */
.sidebar{
position:fixed;
top:0;
left:-260px;
width:260px;
height:100%;
background:#151515;
padding:25px;
transition:.3s;
z-index:2500;
}
.sidebar.open{left:0;}
.sidebar p{padding:10px 0;border-bottom:1px solid #222;cursor:pointer;}

.overlay{
position:fixed;
width:100%;
height:100%;
background:rgba(0,0,0,.6);
display:none;
z-index:2400;
}
.overlay.show{display:block;}

/* ===== CONTENT ===== */
.main{
margin-top:80px;
padding:25px;
max-width:900px;
margin:auto;
}

/* ===== STATS ===== */
.stats{font-size:14px;text-align:right;}

.bar{
width:260px;
height:8px;
background:#333;
border-radius:6px;
overflow:hidden;
margin-top:4px;
}
.bar-fill{height:100%;}
.xp-fill{background:limegreen;}
.energy-fill{background:gold;}

/* ===== CARD ===== */
.card{
background:#1b1b1b;
padding:18px;
margin:15px 0;
border-radius:10px;
}

/* ===== BUTTON ===== */
button{
width:100%;
padding:12px;
background:gold;
border:none;
border-radius:6px;
font-weight:bold;
cursor:pointer;
margin-top:10px;
}

/* ===== MISSION BAR ===== */
.mission-progress{
width:100%;
height:8px;
background:#333;
border-radius:6px;
margin:10px 0;
overflow:hidden;
}
.progress-fill{
height:100%;
width:0%;
background:gold;
transition:.05s linear;
}

/* ===== FX ===== */

#fx-dim{
position:fixed;
inset:0;
background:black;
opacity:0;
pointer-events:none;
transition:.25s;
z-index:1800;
}

@keyframes shake{
0%{transform:translate(0)}
25%{transform:translate(-4px,2px)}
50%{transform:translate(4px,-2px)}
75%{transform:translate(-3px,1px)}
100%{transform:translate(0)}
}
.shake{animation:shake .35s;}

.fx-success{
position:fixed;
inset:0;
background:rgba(0,255,120,.25);
z-index:1900;
}
.fx-fail{
position:fixed;
inset:0;
background:rgba(255,0,0,.25);
z-index:1900;
}

</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
<h3 style="color:gold">Men√º</h3>
<p onclick="PAGE.go('index')">üè† Ana Sayfa</p>
<p onclick="PAGE.go('missions')">üéØ G√∂revler</p>
<p onclick="PAGE.go('pvp')">‚öî PvP</p>
</div>

<div class="overlay" id="overlay"></div>

<!-- TOPBAR -->
<div class="topbar">
<div>
<span class="menu-btn" onclick="openMenu()">‚ò∞</span>
<span class="logo">TonCrime</span>
</div>

<div class="stats">
<div id="stats"></div>
<div class="bar"><div id="xpBar" class="bar-fill xp-fill"></div></div>
<div class="bar"><div id="energyBar" class="bar-fill energy-fill"></div></div>
</div>
</div>

<div class="main">
<div id="tc-content"></div>
</div>

<script>

/* ================= CONFIG ================= */

window.CONFIG={
SUPABASE_URL:"https://hwhscuyudwphnsipibpy.supabase.co",
SUPABASE_KEY:"sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu",
XP_LIMIT:100,
MAX_ENERGY:100,
ENERGY_INTERVAL:300000
};

window.db=supabase.createClient(
CONFIG.SUPABASE_URL,
CONFIG.SUPABASE_KEY
);

/* ================= TELEGRAM LOGIN ================= */

async function telegramLogin(){

if(!window.Telegram){
console.log("Browser mode");
CONFIG.USER_ID="591676206";
startGame();
return;
}

const tg=Telegram.WebApp;
tg.ready();
tg.expand();

const user=tg.initDataUnsafe.user;

if(!user){
alert("Telegram user bulunamadƒ±");
return;
}

const id=String(user.id);

localStorage.setItem("tc_user",id);
CONFIG.USER_ID=id;

const {data}=await db.from("users")
.select("*")
.eq("id",id)
.maybeSingle();

if(!data){

await db.from("users").insert({
id:id,
nickname:user.username||user.first_name,
level:1,
xp:0,
energy:100,
yton:5,
last_energy_tick:Date.now()
});

}

startGame();
}

/* ================= MENU ================= */

function openMenu(){
sidebar.classList.add("open");
overlay.classList.add("show");
}
overlay.onclick=()=>{
sidebar.classList.remove("open");
overlay.classList.remove("show");
};

/* ================= ROUTER ================= */

window.PAGE={
go(p){
location.hash=p;
loadPage();
}
};

function loadPage(){

const page=location.hash.replace("#","")||"index";

if(page==="index"){
tc_content.innerHTML="<h2>üèô Yeraltƒ± ≈ûehri</h2>";
}

if(page==="missions"){
if(window.MISSIONS) MISSIONS.render();
}

if(page==="pvp"){
tc_content.innerHTML="<h2>‚öî PvP Arena</h2>";
}

}

/* ================= GAME START ================= */

function startGame(){
console.log("üöÄ TonCrime Started");
loadPage();
}

/* START */
telegramLogin();

</script>

<!-- ENGINES -->
<script src="engine/engine.js"></script>
<script src="engine/ui.engine.js"></script>
<script src="engine/layout.engine.js"></script>
<script src="engine/fx.engine.js"></script>
<script src="engine/missions.engine.js"></script>

</body>
</html>
