<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TonCrime</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
background:#0e0e0e;
color:white;
font-family:Arial;
}

/* ===== TOPBAR ===== */
.topbar{
background:#111;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center;
border-bottom:1px solid #222;
}

.logo{color:gold;font-size:22px;font-weight:bold}

.menuBtn{
cursor:pointer;
font-size:22px;
margin-right:15px;
}

/* ===== MENU ===== */
.sidebar{
position:fixed;
top:0;
left:-260px;
width:250px;
height:100%;
background:#151515;
padding:25px;
transition:.3s;
z-index:2000;
}

.sidebar.open{left:0}

.overlay{
position:fixed;
width:100%;
height:100%;
background:rgba(0,0,0,.6);
display:none;
z-index:1500;
}

.overlay.show{display:block}

.sidebar p{
cursor:pointer;
margin:12px 0;
color:#ddd;
}

/* ===== LAYOUT ===== */
.main{
display:flex;
gap:25px;
padding:25px;
}

.card{
background:#1b1b1b;
padding:20px;
border-radius:10px;
margin-bottom:20px;
}

.chatBox{
height:260px;
background:#111;
overflow:auto;
padding:10px;
}

input{
width:100%;
padding:10px;
background:#222;
border:none;
color:white;
}
</style>
</head>

<body>

<!-- MENU -->
<div class="sidebar" id="sidebar">
<h3 style="color:gold">MenÃ¼</h3>

<p onclick="go('index.html')">ğŸ  Ana Sayfa</p>
<p onclick="go('missions.html')">ğŸ¯ GÃ¶revler</p>
<p onclick="go('coffeeshop.html')">â˜• Coffee</p>
<p onclick="go('nightclub.html')">ğŸ¾ Gece KulÃ¼bÃ¼</p>
<p onclick="go('pvp.html')">âš” PvP Arena</p>

</div>

<div class="overlay" id="overlay"></div>

<!-- TOPBAR -->
<div class="topbar">
<div>
<span class="menuBtn" onclick="openMenu()">â˜°</span>
<span class="logo">TonCrime</span>
</div>

<div id="stats">yÃ¼kleniyor...</div>
</div>

<div class="main">

<div style="width:60%">

<div class="card">
<h3>ğŸ† Aktif Turnuva</h3>
<div id="tournamentBoard">yÃ¼kleniyor...</div>
</div>

<div class="card">
<h3>ğŸ’¬ Clan Chat</h3>
<div id="chatBox" class="chatBox"></div>
<input id="chatInput" placeholder="Mesaj..."
onkeydown="if(event.key==='Enter')sendChat()">
</div>

</div>

<div style="width:25%">

<div class="card">
<h3>ğŸ‘¤ Oyuncu</h3>
<div id="userInfo">yÃ¼kleniyor...</div>
</div>

<div class="card">
<h3>ğŸŒ Online</h3>
<div id="onlineCount">0</div>
</div>

</div>

</div>

<script>
/* ================= CONFIG ================= */

window.CONFIG={
SUPABASE_URL:"https://hwhscuyudwphnsipibpy.supabase.co",
SUPABASE_KEY:"sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu",
USER_ID:"591676206",
XP_LIMIT:100,
MAX_ENERGY:100,
ENERGY_INTERVAL:300000
};

window.GAME={
user:null,
loading:false,
pvpSubscribed:false
};

window.db=window.supabase.createClient(
CONFIG.SUPABASE_URL,
CONFIG.SUPABASE_KEY
);

/* ================= MENU ================= */

function openMenu(){
sidebar.classList.add("open");
overlay.classList.add("show");
}

overlay.onclick=()=>{
sidebar.classList.remove("open");
overlay.classList.remove("show");
}

function go(p){location.href=p}

/* ================= USER LOAD ================= */

async function loadUser(){

const {data}=await db
.from("users")
.select("*")
.eq("id",CONFIG.USER_ID)
.single();

GAME.user=data;
renderUser();
renderStats();
}

function renderStats(){

const u=GAME.user;
if(!u) return;

stats.innerHTML=
`Lv ${u.level} | XP ${u.xp}/100 | âš¡ ${u.energy} | ğŸ’° ${Number(u.yton).toFixed(2)}`;
}

function renderUser(){

const u=GAME.user;
if(!u) return;

userInfo.innerHTML=
`
ID: ${u.id}<br>
Nick: ${u.nickname}<br>
Level: ${u.level}<br>
XP: ${u.xp}<br>
Enerji: ${u.energy}
`;
}

/* ================= ONLINE PRESENCE ================= */

function subscribeOnline(){

db.channel("online-room")
.on("presence",{event:"sync"},()=>{
const state=db.channel("online-room").presenceState();
onlineCount.innerText=Object.keys(state).length;
})
.subscribe(async(status)=>{
if(status==="SUBSCRIBED"){
await db.channel("online-room").track({
user:CONFIG.USER_ID
});
}
});
}

/* ================= CHAT ================= */

function sendChat(){

const msg=chatInput.value.trim();
if(!msg) return;

chatBox.innerHTML+=`<div>ğŸ§‘ ${msg}</div>`;
chatInput.value="";
chatBox.scrollTop=chatBox.scrollHeight;
}

/* ================= INIT ================= */

document.addEventListener("DOMContentLoaded",async()=>{
await loadUser();
subscribeOnline();
});
</script>

</body>
</html>
