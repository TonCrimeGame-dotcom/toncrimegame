<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TonCrime</title>
<link rel="stylesheet" href="global.css">
</head>
<body>

<div class="app">

  <img src="background.jpg" class="bg">
  <img src="logo.png" class="logo">

  <!-- ===== USER PANEL ===== -->
  <div class="hud">

    <div id="energyText">⚡ 0/100</div>
    <div class="bar">
      <div class="fill" id="energyBar"></div>
    </div>

    <div id="xpText">XP 0/1000 (Lv 1)</div>
    <div class="bar">
      <div class="fill" id="xpBar"></div>
    </div>

    <div class="yton-row">
      <img src="yton.png">
      <span id="ytonText">0</span>
    </div>

  </div>

  <!-- ===== SLIDE MENU ===== -->
  <div class="menu-wrapper">
    <div class="menu-slider">

      <div class="menu-card" onclick="go('missions.html')">
        <img src="missions.jpg">
        <span>Görevler</span>
      </div>

      <div class="menu-card" onclick="go('pvp.html')">
        <img src="pvp.jpg">
        <span>PvP</span>
      </div>

      <div class="menu-card" onclick="go('nightclub.html')">
        <img src="nightclub.jpg">
        <span>Gece Kulübü</span>
      </div>

      <div class="menu-card" onclick="go('coffeeshop.html')">
        <img src="coffeeshop.jpg">
        <span>CoffeeShop</span>
      </div>

      <div class="menu-card" onclick="go('xxx.html')">
        <img src="xxx.jpg">
        <span>Genel Ev</span>
      </div>

      <div class="menu-card" onclick="go('weapons.html')">
        <img src="weapons.jpg">
        <span>Silah Tüccarı</span>
      </div>

    </div>
  </div>

  <!-- ===== CHAT ===== -->
  <div class="chat">
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Mesaj...">
      <button onclick="sendMessage()">Gönder</button>
    </div>
  </div>

</div>


<script src="engine/player.engine.js"></script>

<script>

/* ===== SAFE INIT ===== */
document.addEventListener("DOMContentLoaded", () => {

  if (typeof PlayerEngine !== "undefined") {

    const player = PlayerEngine.getPlayer();

    const xpMax = player.xpMax || 1000;
    const maxEnergy = player.maxEnergy || 100;

    // ENERGY
    document.getElementById("energyText").textContent =
      "⚡ " + player.energy + "/" + maxEnergy;

    document.getElementById("energyBar").style.width =
      (player.energy / maxEnergy * 100) + "%";

    // XP
    document.getElementById("xpText").textContent =
      "XP " + player.xp + "/" + xpMax + " (Lv " + player.level + ")";

    document.getElementById("xpBar").style.width =
      (player.xp / xpMax * 100) + "%";

    // YTON
    document.getElementById("ytonText").textContent = player.yton;

  }

  loadChat();

});

/* ===== NAV ===== */
function go(page){
  window.location.href = page;
}

/* ===== CHAT (LOCAL) ===== */

let chatData = JSON.parse(localStorage.getItem("chat")) || [];

function saveChat(){
  localStorage.setItem("chat", JSON.stringify(chatData));
}

function loadChat(){
  const container = document.getElementById("chatMessages");
  container.innerHTML="";
  chatData.forEach(msg=>{
    const div=document.createElement("div");
    div.textContent=msg;
    container.appendChild(div);
  });
}

function sendMessage(){
  const input=document.getElementById("chatInput");
  const msg=input.value.trim();
  if(!msg) return;

  const username =
    (typeof PlayerEngine !== "undefined")
      ? PlayerEngine.getPlayer().username
      : "Player";

  const fullMsg = username + ": " + msg;

  chatData.push(fullMsg);
  saveChat();
  loadChat();
  input.value="";
}

</script>

</body>
</html>
