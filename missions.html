<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>TonCrimeGame â€“ GÃ¶revler</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{margin:0;background:#000;color:#fff;font-family:Arial}

/* ===== TOPBAR ===== */
.topbar{
  position:fixed;top:0;left:0;right:0;
  height:60px;background:#050505;
  display:flex;align-items:center;
  padding:0 12px;z-index:1000;
  border-bottom:1px solid #222;
}
.menu-btn{font-size:22px;cursor:pointer;margin-right:10px}
.logo{color:#f90;font-weight:bold;min-width:140px}
.xp-box{flex:1;padding:0 12px}
.xp-bar{width:100%;height:8px;background:#222;border-radius:10px;overflow:hidden}
.xp-fill{height:100%;width:0%;background:linear-gradient(90deg,#f90,#ff0);transition:.5s}
.energy-bar{width:100%;height:6px;background:#111;border-radius:10px;overflow:hidden;margin-top:3px}
.energy-fill{height:100%;width:0%;background:linear-gradient(90deg,#00ffcc,#00ff66);transition:.5s}
.stats{text-align:right;font-size:13px;min-width:100px}

/* ===== MENU ===== */
.side-menu{
  position:fixed;top:60px;left:-240px;
  width:240px;height:100%;
  background:#0a0a0a;transition:.3s;z-index:999;
}
.side-menu.open{left:0}
.side-menu a{
  display:block;padding:14px;color:#fff;
  text-decoration:none;border-bottom:1px solid #222;
}
.side-menu a:hover{background:#111}
#overlay{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.4);z-index:998;
}

/* ===== LAYOUT ===== */
.wrapper{display:flex;padding-top:80px}
.left{width:55%;padding:15px}
.right{width:45%;padding:15px;border-left:1px solid #222}

/* ===== MISSIONS ===== */
.mission{background:#111;padding:12px;border-radius:10px;margin-bottom:12px}
.mission button{width:100%;margin-top:8px;padding:10px;background:#f90;border:none;border-radius:8px;font-weight:bold}

/* ===== TABLE ===== */
.table{background:#111;padding:10px;border-radius:10px}
.row{border-bottom:1px solid #222;padding:5px 0;font-size:13px}
.success{color:#0f0}
.fail{color:#f33}
</style>
</head>

<body>

<!-- ===== TOPBAR ===== -->
<div class="topbar">
  <div class="menu-btn" onclick="toggleMenu()">â˜°</div>
  <div class="logo">ğŸ”¥ YeraltÄ± Åehri</div>

  <div class="xp-box">
    <div style="font-size:11px">
      Level <span id="lvl"></span>
    </div>
    <div class="xp-bar">
      <div class="xp-fill" id="xpFill"></div>
    </div>
  </div>

  <div class="stats">
    âš¡ <span id="energy"></span>
    <div class="energy-bar">
      <div class="energy-fill" id="energyFill"></div>
    </div>
    ğŸ’° <span id="yton"></span>
  </div>
</div>

<div id="overlay" onclick="closeMenu()"></div>

<div class="side-menu" id="menu">
  <a href="index.html">ğŸ  Ana MenÃ¼</a>
  <a href="missions.html">ğŸ§¾ GÃ¶revler</a>
  <a href="pvp.html">âš”ï¸ PvP</a>
  <a href="nightlife.html">ğŸŒƒ Gece HayatÄ±</a>
  <a href="weapons.html">ğŸ”« Silah TÃ¼ccarÄ±</a>
  <a href="hospital.html">ğŸ¥ Hastane</a>
</div>

<div class="wrapper">
  <div class="left" id="missions"></div>

  <div class="right">
    <div class="table">
      <b>ğŸ“Š GÃ¶rev Ä°statistik</b>
      <div id="statsBox"></div>
      <hr>
      <b>ğŸ•’ GeÃ§miÅŸ</b>
      <div id="historyBox"></div>
    </div>
  </div>
</div>

<script src="engine.js"></script>
 <script>setInterval(() => {

  const p = JSON.parse(localStorage.getItem("player"));
  if (!p) return;

  const energyEl = document.getElementById("energy");
  const energyFill = document.getElementById("energyFill");

  if (energyEl) energyEl.innerText = p.energy;

  if (energyFill) {
    energyFill.style.width = (p.energy / 100) * 100 + "%";
  }

}, 1000);
<script>

/* ===== MENU ===== */
function toggleMenu(){
  document.getElementById("menu").classList.toggle("open");
  document.getElementById("overlay").style.display="block";
}
function closeMenu(){
  document.getElementById("menu").classList.remove("open");
  document.getElementById("overlay").style.display="none";
}

/* ===== PLAYER UI SYNC ===== */
function updateTopUI(){
  document.getElementById("lvl").innerText=player.level;
  document.getElementById("energy").innerText=player.energy;
  document.getElementById("yton").innerText=player.yton;

  document.getElementById("xpFill").style.width=
    (player.xp/player.xpNext*100)+"%";

  document.getElementById("energyFill").style.width=
    (player.energy/100*100)+"%";
}

setInterval(updateTopUI,500);
updateTopUI();

/* ===== GAME BANK ===== */
let gameBank=parseInt(localStorage.getItem("gameBank"))||0;

/* ===== MISSIONS ===== */
const missionsData=[
 {name:"Sokak TemizliÄŸi",energy:10,xp:20,yton:50,risk:20},
 {name:"KaÃ§ak Mal",energy:15,xp:30,yton:80,risk:30}
];

let history=JSON.parse(localStorage.getItem("missionHistory"))||[];
let repeatCounter=JSON.parse(localStorage.getItem("missionRepeat"))||{};
let stats=JSON.parse(localStorage.getItem("missionStats"))||{success:0,fail:0};

const box=document.getElementById("missions");

missionsData.forEach(m=>{
  box.innerHTML+=`
  <div class="mission">
    <b>${m.name}</b><br>
    âš¡ ${m.energy} | â­ ${m.xp} XP | ğŸ’° ${m.yton}
    <button onclick="startMission('${m.name}',${m.energy},${m.xp},${m.yton},${m.risk})">
      BaÅŸlat
    </button>
  </div>`;
});

function startMission(name,energy,xp,yton,baseRisk){

  if(Date.now()<player.hospitalUntil){
    alert("ğŸ¥ Hastanedesin!");
    return;
  }

  if(!useEnergy(energy)){
    alert("Enerji yetersiz");
    return;
  }

  if(!repeatCounter[name]) repeatCounter[name]=0;
  repeatCounter[name]++;

  let riskMultiplier=Math.floor(repeatCounter[name]/10);
  let finalRisk=baseRisk*(1+riskMultiplier);

  let success=Math.random()*100>finalRisk;
  let time=new Date().toLocaleTimeString();

  if(success){
    addXP(xp);
    addYton(yton);
    stats.success++;
    history.unshift({name,time,result:"success"});
  }else{
    stats.fail++;
    let lost=Math.floor(yton/2);
    removeYton(lost);
    gameBank+=lost;
    localStorage.setItem("gameBank",gameBank);
    addXP(-Math.floor(xp/2));

    if(Math.random()<0.5){
      player.hospitalUntil=Date.now()+600000;
      savePlayer();
    }

    history.unshift({name,time,result:"fail"});
  }

  localStorage.setItem("missionHistory",JSON.stringify(history));
  localStorage.setItem("missionRepeat",JSON.stringify(repeatCounter));
  localStorage.setItem("missionStats",JSON.stringify(stats));

  renderStats();
}

function renderStats(){
  document.getElementById("statsBox").innerHTML=
  `âœ… ${stats.success} <br> âŒ ${stats.fail} <br> ğŸ¦ ${gameBank} YTon`;

  let h="";
  history.slice(0,15).forEach(x=>{
    h+=`<div class="row ${x.result}">
      ${x.time} - ${x.name} - 
      ${x.result==="success"?"BaÅŸarÄ±lÄ±":"BaÅŸarÄ±sÄ±z"}
    </div>`;
  });
  document.getElementById("historyBox").innerHTML=h;
}

renderStats();

</script>
</body>
</html>
