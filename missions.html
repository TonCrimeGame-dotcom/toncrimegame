<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TonCrime - GÃ¶revler</title>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{margin:0;background:#0e0e0e;font-family:Arial;color:white}

/* HEADER */
.header{
position:fixed;top:0;left:0;right:0;height:60px;
background:#111;display:flex;align-items:center;
justify-content:space-between;padding:0 15px;
z-index:1000;border-bottom:1px solid #222;
}

.logo{font-size:22px;font-weight:bold;color:#ffb300}
.stats{font-size:14px}
.menuBtn{font-size:22px;cursor:pointer;margin-right:10px}

/* USER PANEL */
.userPanel{
margin-top:70px;background:#1a1a1a;padding:15px;
border-radius:8px;margin:70px 15px 10px 15px
}

/* MENU */
.menu{
position:fixed;top:0;left:-250px;width:250px;height:100%;
background:#181818;transition:.3s;padding-top:60px;z-index:2000
}

.menu a{
display:block;padding:15px;color:white;
text-decoration:none;border-bottom:1px solid #222
}

.menu a:hover{background:#222}

.overlay{
position:fixed;top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,.6);display:none;z-index:1500
}

/* CONTENT */
.content{padding:15px}

.card{
background:#1a1a1a;padding:15px;border-radius:8px;
margin-bottom:15px
}

button{
width:100%;padding:10px;border:none;
background:#ffb300;color:black;
border-radius:6px;font-weight:bold;cursor:pointer
}
</style>
</head>
<body>

<div class="header">
<div>
<span class="menuBtn" onclick="openMenu()">â˜°</span>
<span class="logo">TonCrime</span>
</div>
<div class="stats" id="topStats">YÃ¼kleniyor...</div>
</div>

<div class="menu" id="sideMenu">
<a href="index.html">ğŸ  Ana Sayfa</a>
<a href="missions.html">ğŸ“‹ GÃ¶revler</a>
<a href="#">âš” PvP</a>
<a href="#">ğŸ”« Silah KaÃ§akÃ§Ä±sÄ±</a>
<a href="#">ğŸ¥ Hastane</a>
</div>

<div class="overlay" id="overlay" onclick="closeMenu()"></div>

<div class="userPanel" id="userPanel">YÃ¼kleniyor...</div>

<div class="content" id="missionsArea"></div>

<script>
const supabaseClient = supabase.createClient(
"https://hwhscuyudwphnsipibpy.supabase.co",
"sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu"
);

/* DOÄRU USER ID */
let userId = 591676206;

function openMenu(){
document.getElementById("sideMenu").style.left="0";
document.getElementById("overlay").style.display="block";
}

function closeMenu(){
document.getElementById("sideMenu").style.left="-250px";
document.getElementById("overlay").style.display="none";
}

async function loadPlayer(){
let {data} = await supabaseClient
.from("users").select("*").eq("id",userId).single();

if(!data){
document.getElementById("topStats").innerHTML="KullanÄ±cÄ± bulunamadÄ±";
return;
}

document.getElementById("topStats").innerHTML =
`Lv ${data.level} | XP ${data.xp}/100 | âš¡ ${data.energy}/100 | ğŸ’° ${data.yton}`;

document.getElementById("userPanel").innerHTML =
`ID: ${data.id}<br>
Takma Ad: ${data.nickname}<br>
Level: ${data.level}<br>
XP: ${data.xp}`;
}

async function loadMissions(){
let {data} = await supabaseClient.from("missions").select("*");

let html="";
data.forEach(m=>{
html+=`
<div class="card">
<b>${m.name}</b><br>
Enerji: ${m.energy_cost}<br>
XP: ${m.xp_reward}<br>
KazanÃ§: ${m.yton_reward} YTon<br>
BaÅŸarÄ± OranÄ±: %${m.success_rate}
<br><br>
<button onclick="startMission(${m.id})">BaÅŸlat</button>
</div>`;
});
document.getElementById("missionsArea").innerHTML=html;
}

async function startMission(id){

let {data:user} = await supabaseClient
.from("users").select("*").eq("id",userId).single();

let {data:mission} = await supabaseClient
.from("missions").select("*").eq("id",id).single();

if(user.energy < mission.energy_cost){
alert("Yeterli enerji yok!");
return;
}

let success = Math.random()*100 <= mission.success_rate;

let newEnergy = user.energy - mission.energy_cost;
let newXp = user.xp;
let newYton = user.yton;

if(success){
newXp += mission.xp_reward;
newYton += mission.yton_reward;
alert("BaÅŸarÄ±lÄ±: "+mission.name);
}else{
alert("BaÅŸarÄ±sÄ±z oldun!");
}

await supabaseClient.from("users")
.update({
energy:newEnergy,
xp:newXp,
yton:newYton
})
.eq("id",userId);

loadPlayer();
}

async function energyRegen(){
let {data} = await supabaseClient
.from("users").select("*").eq("id",userId).single();

if(data.energy < 100){
await supabaseClient.from("users")
.update({energy:data.energy+1})
.eq("id",userId);
}
loadPlayer();
}

setInterval(energyRegen,300000);

loadPlayer();
loadMissions();
</script>

</body>
</html>
