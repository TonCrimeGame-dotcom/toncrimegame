<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TonCrime</title>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  background:#0e0e0e;
  color:white;
  font-family:Arial;
}

/* TOP BAR */
.topbar{
  background:#111;
  padding:15px 35px; /* artÄ±rÄ±ldÄ± */
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #222;
}

.menu-btn{
  font-size:24px;
  cursor:pointer;
  margin-left:10px; /* saÄŸa kaydÄ±rÄ±ldÄ± */
}

/* SIDEBAR */
.sidebar{
  position:fixed;
  top:0;
  left:-260px;
  width:250px;
  height:100%;
  background:#151515;
  padding:25px;
  transition:0.3s;
  z-index:1000;
}

.sidebar.open{
  left:0;
}

.overlay{
  position:fixed;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.6);
  display:none;
  z-index:900;
}

.overlay.show{
  display:block;
}

/* MAIN LAYOUT */
.main{
  display:flex;
  justify-content:center;
  gap:40px;
  padding:40px;
  width:100%;
  box-sizing:border-box;
}

.missions{
  width:55%;
}

.userpanel{
  width:25%;
  background:#151515;
  padding:20px;
  border-radius:10px;
  height:fit-content;
}

/* CARD */
.card{
  background:#1b1b1b;
  padding:18px;
  margin-bottom:25px;
  border-radius:10px;
}

button{
  width:100%;
  padding:12px;
  background:gold;
  border:none;
  font-weight:bold;
  cursor:pointer;
  border-radius:6px;
  margin-top:10px;
}

button:hover{
  opacity:0.9;
}

/* RESPONSIVE */
@media(max-width:1100px){
  .main{
    flex-direction:column;
    align-items:center;
  }
  .missions,
  .userpanel{
    width:90%;
  }
}
</style>
</head>
<body>

<div class="topbar">
  <div class="menu-btn" onclick="openMenu()">â˜°</div>
  <div><b>TonCrime</b></div>
  <div id="stats">YÃ¼kleniyor...</div>
</div>

<div class="sidebar" id="sidebar">
  <h3>MenÃ¼</h3>
  <p>ğŸ  Ana Sayfa</p>
  <p>ğŸ¯ GÃ¶revler</p>
  <p>ğŸ›’ Market</p>
  <p>âš” PvP</p>
</div>

<div class="overlay" id="overlay" onclick="closeMenu()"></div>

<div class="main">
  <div class="missions" id="missions"></div>
  <div class="userpanel" id="userinfo"></div>
</div>

<script>
const SUPABASE_URL="https://hwhscuyudwphnsipibpy.supabase.co";
const SUPABASE_KEY="sb_publishable_dItLcV8z83CvDWuR8nTabA_ImTHGETu";
const supabaseClient=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
const userId="591676206";

function openMenu(){
  document.getElementById("sidebar").classList.add("open");
  document.getElementById("overlay").classList.add("show");
}
function closeMenu(){
  document.getElementById("sidebar").classList.remove("open");
  document.getElementById("overlay").classList.remove("show");
}

async function loadUser(){
  const {data}=await supabaseClient.from("users").select("*").eq("id",userId).single();
  return data;
}

async function loadMissions(){
  const {data}=await supabaseClient.from("missions").select("*");
  return data;
}

async function render(){
  const user=await loadUser();
  const missions=await loadMissions();

  document.getElementById("stats").innerHTML=
  `Lv ${user.level} | XP ${user.xp}/100 | âš¡ ${user.energy} | ğŸ’° ${Number(user.yton).toFixed(2)}`;

  document.getElementById("userinfo").innerHTML=`
    <h3>KullanÄ±cÄ±</h3>
    <b>ID:</b> ${user.id}<br><br>
    <b>Takma Ad:</b> ${user.nickname}<br><br>
    <b>Toplam GÃ¶rev:</b> ${user.total_missions || 0}<br>
    <b>Kazanma:</b> ${user.wins || 0}<br>
    <b>Kaybetme:</b> ${user.losses || 0}
  `;

  let html="";
  missions.forEach(m=>{
    html+=`
    <div class="card">
      <b>${m.name}</b><br><br>
      Enerji: ${m.energy_cost}<br>
      XP: ${m.xp_reward}<br>
      KazanÃ§: ${m.yton_reward} Yton<br>
      BaÅŸarÄ±: %${m.success_rate}
      <button onclick="startMission(${m.id})">BaÅŸlat</button>
    </div>
    `;
  });

  document.getElementById("missions").innerHTML=html;
}

async function startMission(id){
  const user=await loadUser();
  const {data:mission}=await supabaseClient.from("missions").select("*").eq("id",id).single();

  if(user.energy<mission.energy_cost){
    alert("Yetersiz enerji");
    return;
  }

  let energy=user.energy-mission.energy_cost;
  let xp=user.xp;
  let yton=Number(user.yton);
  let level=user.level;
  let total=(user.total_missions||0)+1;
  let wins=user.wins||0;
  let losses=user.losses||0;

  if(Math.random()*100<mission.success_rate){
    xp+=mission.xp_reward;
    yton+=mission.yton_reward;
    wins++;
    if(xp>=100){level++;xp-=100;}
    alert("BaÅŸarÄ±lÄ±!");
  }else{
    losses++;
    alert("BaÅŸarÄ±sÄ±z!");
  }

  await supabaseClient.from("users").update({
    energy,xp,yton,level,total_missions:total,wins,losses
  }).eq("id",userId);

  render();
}

render();
</script>

</body>
</html>
