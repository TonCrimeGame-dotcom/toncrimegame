<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TonCrime - Silah KaÃ§akÃ§Ä±sÄ±</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="game-core.js"></script>

<style>
body{
  margin:0;
  background:#1a0e0e;
  color:white;
  font-family:Arial;
}

/* TOPBAR */
.topbar{
  background:#2b1111;
  padding:18px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.right-stats{ width:420px; }

.bar{
  width:100%;
  height:8px;
  background:#333;
  border-radius:5px;
  overflow:hidden;
  margin-bottom:6px;
}

.fill{ height:100%; }
.xp{ background:#ff4444; }
.energy{ background:#ffaa00; }

/* GRID */
.main{
  padding:40px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:20px;
}

.card{
  background:#2b1111;
  padding:20px;
  border-radius:10px;
  border:1px solid #5c1f1f;
}

button{
  width:100%;
  padding:10px;
  margin-top:10px;
  background:#ff4444;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}

button:hover{ opacity:0.85; }
</style>
</head>
<body>

<div class="topbar">
  <div><b>ðŸ”« Silah KaÃ§akÃ§Ä±sÄ±</b></div>

  <div class="right-stats">
    <div id="stats"></div>

    <div class="bar">
      <div id="xpBar" class="fill xp"></div>
    </div>

    <div class="bar">
      <div id="energyBar" class="fill energy"></div>
    </div>
  </div>
</div>

<div class="main" id="shop"></div>

<script>

/* ===== SÄ°LAHLAR ===== */
function generateWeapons(){

  return [
    {name:"Tabanca", price:120, xp:5},
    {name:"PompalÄ±", price:250, xp:12},
    {name:"AK-47", price:400, xp:20},
    {name:"Keskin NiÅŸancÄ±", price:650, xp:35},
    {name:"MiniGun", price:1000, xp:60}
  ];
}

/* ===== SATIN AL ===== */
async function buyWeapon(weapon){

  let user=await loadUser();
  if(!user) return;

  user=await regenEnergy(user);

  if(user.yton < weapon.price){
    alert("Yetersiz Yton!");
    return;
  }

  await updateUser({
    yton:-weapon.price,
    xp:weapon.xp
  });

  alert(weapon.name + " satÄ±n alÄ±ndÄ±! +" + weapon.xp + " XP");

  render();
}

/* ===== RENDER ===== */
async function render(){

  let user=await loadUser();
  if(!user) return;

  user=await regenEnergy(user);

  renderStats(user);

  let weapons=generateWeapons();
  let html="";

  weapons.forEach(w=>{
    html+=`
      <div class="card">
        <b>${w.name}</b><br>
        Fiyat: ${w.price} Yton<br>
        XP KazancÄ±: ${w.xp}
        <button onclick='buyWeapon(${JSON.stringify(w)})'>
          SatÄ±n Al
        </button>
      </div>
    `;
  });

  document.getElementById("shop").innerHTML=html;
}

render();
setInterval(render,3000);

</script>

</body>
</html>
